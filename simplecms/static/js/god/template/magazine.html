<md-card class="magazine">

  <div layout="row" layout-align="center center" ng-if="!magazine" class="loading">
    <md-progress-circular md-mode="indeterminate" class="md-warn md-hue-3"></md-progress-circular>
  </div>

  <div ng-if="magazine">
    <div class="magazine-title md-display-1">
      <a href="/magazines/{{magazine.id}}" target="_blank">{{magazine.title}}</a>
    </div>

    <md-list class="magazine-posts">

      <md-list-item class="magazine-post-add">
        <a class="post-entry" ng-click="addPost()">
          向杂志中添加一篇新文章……
        </a>
        <md-divider></md-divider>
      </md-list-item>

      <md-list-item class="magazine-post" ng-repeat="post in magazine.posts" class="md-3-line">
        <a class="post-entry" ng-click="editPost(post)" ng-if="!post.opened">
          <h3>{{post.title || '请填写标题'}}</h3>
        </a>
        <a class="post-entry md-default-theme" ng-if="post.opened"
          ng-click="closePost(post)">
          <h3>{{post.title || '请填写标题'}}</h3>
        </a>
        <div class="post-form" ng-if="post.opened">
          <md-input-container>
            <label>选择文章</label>
            <md-select aria-label="文章"
              ng-model="post.post_id"
              ng-change="syncPostTitle(post)"
              >
              <md-option
                ng-repeat="postToSelect in allPosts"
                value="{{postToSelect.id}}"
              >
                {{postToSelect.title}} （{{postToSelect.author}}）
              </md-option>
            </md-select>
          </md-input-container>

          <md-input-container>
            <label>文章标题</label>
            <input type="text" ng-model="post.title"/>
          </md-input-container>

          <md-input-container>
            <label>文章封面图</label>
            <input type="text" ng-model="post.cover"/>
          </md-input-container>

          <md-input-container>
            <label>文章描述</label>
            <textarea ng-model="post.desc"></textarea>
          </md-input-container>

          <md-input-container>
            <label>文章分类</label>
            <input type="text" ng-model="post.category"/>
          </md-input-container>

          <md-input-container>
            <label>文章分类图标</label>
            <input type="text" ng-model="post.category_icon"/>
          </md-input-container>

          <md-button type="button" class="md-raised md-primary save"
            ng-click="publishPost(post)">发布到杂志</md-button>

          <md-button type="button" class="md-raised md-warn"
            ng-if="post.id"
            ng-click="delPost(post)">从杂志中删除</md-button>
          <md-button type="button" class="md-warn"
            ng-if="!post.id"
            ng-click="delPost(post)">先不发布了</md-button>

        </div>
        <md-divider></md-divider>
      </md-list-item>
    </md-list>
  </div>
</md-card>
